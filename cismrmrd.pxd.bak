from libc.stdint cimport uint16_t, uint32_t, uint64_t, int32_t

cdef extern from "ismrmrd_ext.h":
    EncodingCounters* EncodingCounters_new()
    AcquisitionHeader* AcquisitionHeader_new()
    ImageHeader* ImageHeader_new()
    void EncodingCounters_free(EncodingCounters*)
    void AcquisitionHeader_free(AcquisitionHeader*)
    void ImageHeader_free(ImageHeader*)

cdef extern from "ismrmrd.h":
    cdef enum:
        ISMRMRD_VERSION
        ISMRMRD_POSITION_LENGTH
        ISMRMRD_DIRECTION_LENGTH
        ISMRMRD_USER_INTS
        ISMRMRD_USER_FLOATS
        ISMRMRD_PHYS_STAMPS
        ISMRMRD_CHANNEL_MASKS
        # ISMRMRD_VERSION          = 1
        # ISMRMRD_POSITION_LENGTH  = 3
        # ISMRMRD_DIRECTION_LENGTH = 3
        # ISMRMRD_USER_INTS        = 8
        # ISMRMRD_USER_FLOATS      = 8
        # ISMRMRD_PHYS_STAMPS      = 8  # TODO: This should be changed to 3 (Major impact)
        # ISMRMRD_CHANNEL_MASKS    = 16

cdef extern from "ismrmrd.h":
    ctypedef struct EncodingCounters:
        uint16_t kspace_encode_step_1  # e.g. phase encoding line number */
        uint16_t kspace_encode_step_2  # e.g. partition encodning number */
        uint16_t average               # e.g. signal average number */
        uint16_t slice                 # e.g. imaging slice number */
        uint16_t contrast              # e.g. echo number in multi-echo */
        uint16_t phase                 # e.g. cardiac phase number */
        uint16_t repetition            # e.g. dynamic number for dynamic scanning */
        uint16_t set                   # e.g. flow encodning set */
        uint16_t segment               # e.g. segment number for segmented acquisition */
        uint16_t user[ISMRMRD_USER_INTS]   # Free user parameters */

    ctypedef struct AcquisitionHeader:
        uint16_t version   # First unsigned int indicates the version */
        uint64_t flags     # bit field with flags */
        uint32_t measurement_uid   # Unique ID for the measurement */
        uint32_t scan_counter      # Current acquisition number in the measurement */
        uint32_t acquisition_time_stamp    # Acquisition clock */
        uint32_t physiology_time_stamp[ISMRMRD_PHYS_STAMPS] # Physiology time stamps, e.g. ecg, breating, etc. */
        uint16_t number_of_samples # Number of samples acquired */
        uint16_t available_channels    # Available coils */
        uint16_t active_channels       # Active coils on current acquisiton */
        uint64_t channel_mask[ISMRMRD_CHANNEL_MASKS]   # Mask to indicate which channels are active. Support for 1024 channels */
        uint16_t discard_pre       # Samples to be discarded at the beginning of acquisition */
        uint16_t discard_post      # Samples to be discarded at the end of acquisition */
        uint16_t center_sample     # Sample at the center of k-space */
        uint16_t encoding_space_ref    # Reference to an encoding space, typically only one per acquisition */
        uint16_t trajectory_dimensions # Indicates the dimensionality of the trajectory vector (0 means no trajectory) */
        float sample_time_us                                   # Time between samples in micro seconds, sampling BW */
        float position[ISMRMRD_POSITION_LENGTH] # Three-dimensional spatial offsets from isocenter */
        float read_dir[ISMRMRD_DIRECTION_LENGTH] # Directional cosines of the readout/frequency encoding */
        float phase_dir[ISMRMRD_DIRECTION_LENGTH] # Directional cosines of the phase */
        float slice_dir[ISMRMRD_DIRECTION_LENGTH] # Directional cosines of the slice direction */
        float patient_table_position[ISMRMRD_POSITION_LENGTH]  # Patient table off-center */
        EncodingCounters idx       # Encoding loop counters, see above */
        int32_t user_int[ISMRMRD_USER_INTS]       # Free user parameters */
        float user_float[ISMRMRD_USER_FLOATS]     # Free user parameters */

    cdef enum ImageDataType:
        DATA_FLOAT = 1
        DATA_DOUBLE
        DATA_COMPLEX_FLOAT
        DATA_COMPLEX_DOUBLE
        DATA_UNSIGNED_SHORT

    cdef enum ImageType:
        TYPE_MAGNITUDE = 1
        TYPE_PHASE
        TYPE_REAL
        TYPE_IMAG
        TYPE_COMPLEX

    # IMAGE FLAGS
    cdef enum ImageFlags:
        IMAGE_IS_NAVIGATION_DATA                      = 23

        IMAGE_USER1                                   = 57
        IMAGE_USER2                                   = 58
        IMAGE_USER3                                   = 59
        IMAGE_USER4                                   = 60
        IMAGE_USER5                                   = 61
        IMAGE_USER6                                   = 62
        IMAGE_USER7                                   = 63
        IMAGE_USER8                                   = 64

    ctypedef struct ImageHeader:
        uint16_t version    # First unsigned int indicates the version */
        uint64_t flags      # bit field with flags */
        uint32_t measurement_uid    # Unique ID for the measurement  */
        uint16_t matrix_size[3]     # Pixels in the 3 spatial dimensions */
        float field_of_view[3]      # Size (in mm) of the 3 spatial dimensions */
        uint16_t channels           # Number of receive channels */
        float position[ISMRMRD_POSITION_LENGTH]     # Three-dimensional spatial offsets from isocenter */
        float read_dir[ISMRMRD_DIRECTION_LENGTH]    # Directional cosines of the readout/frequency encoding */
        float phase_dir[ISMRMRD_DIRECTION_LENGTH]   # Directional cosines of the phase */
        float slice_dir[ISMRMRD_DIRECTION_LENGTH]   # Directional cosines of the slice direction */
        float patient_table_position[ISMRMRD_POSITION_LENGTH] # Patient table off-center */
        uint16_t average    # e.g. signal average number */
        uint16_t slice      # e.g. imaging slice number */
        uint16_t contrast   # e.g. echo number in multi-echo */
        uint16_t phase      # e.g. cardiac phase number */
        uint16_t repetition # e.g. dynamic number for dynamic scanning */
        uint16_t set        # e.g. flow encodning set */
        uint32_t acquisition_time_stamp # Acquisition clock */
        uint32_t physiology_time_stamp[ISMRMRD_PHYS_STAMPS] # Physiology time stamps, e.g. ecg, breating, etc. */
        uint16_t image_data_type    # e.g. unsigned short, float, complex float, etc. */
        uint16_t image_type     # e.g. magnitude, phase, complex, real, imag, etc. */
        uint16_t image_index    # e.g. image number in series of images  */
        uint16_t image_series_index             # e.g. series number */
        int32_t user_int[ISMRMRD_USER_INTS]     # Free user parameters */
        float user_float[ISMRMRD_USER_FLOATS]   # Free user parameters */
